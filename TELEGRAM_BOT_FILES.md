# –§–∞–π–ª—ã Telegram-–±–æ—Ç–∞ SDS

## –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –ø–æ —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç—É –≤ –ø—Ä–æ–µ–∫—Ç–µ

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `src/telegram_bot/__init__.py` | –ü–∞–∫–µ—Ç –±–æ—Ç–∞ |
| `src/telegram_bot/bot.py` | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ |
| `src/telegram_bot/config.py` | –ö–æ–Ω—Ñ–∏–≥: `TELEGRAM_BOT_TOKEN`, `SDS_API_URL`, —Ç–∞–π–º–∞—É—Ç—ã, —Ç–∞–π–º–∑–æ–Ω–∞ |
| `src/telegram_bot/sds_api.py` | HTTP-–∫–ª–∏–µ–Ω—Ç –∫ SDS API: –ª–æ–≥–∏–Ω, –∑–∞–∫–∞–∑—ã, –∫–ª–∏–µ–Ω—Ç—ã, —Ä–µ–π—Å—ã –∏ —Ç.–¥. |
| `src/telegram_bot/session.py` | –°–µ—Å—Å–∏–∏ –≤ –ë–î (`telegram_sessions`), –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞, –ª–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π |
| `src/telegram_bot/handlers_auth.py` | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: –≤–≤–æ–¥ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è, –≤—ã–∑–æ–≤ API, –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é, –≤—ã—Ö–æ–¥ |
| `src/telegram_bot/handlers_agent.py` | –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–æ–ª–∏ ¬´–∞–≥–µ–Ω—Ç¬ª: –∫–ª–∏–µ–Ω—Ç—ã, –∑–∞–∫–∞–∑—ã, —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ |
| `src/telegram_bot/handlers_agent_v3_add_customer.py` | **[NEW v3]** FSM-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ —Å –ª–∏–Ω–µ–π–Ω—ã–º –¥–∏–∞–ª–æ–≥–æ–º |
| `src/telegram_bot/handlers_expeditor.py` | –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–æ–ª–∏ ¬´—ç–∫—Å–ø–µ–¥–∏—Ç–æ—Ä¬ª: —Ä–µ–π—Å—ã, –¥–æ—Å—Ç–∞–≤–∫–∏, —á–µ–∫–∏ |
| `src/telegram_bot/helpers.py` | –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ —Ç.–ø.) |
| `ubuntu_telegram_uz_sales_bot` | –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –Ω–∞ Ubuntu (–≤ —Ñ–æ–Ω–µ, –ª–æ–≥ –≤ `telegram_bot.log`) |
| `ubuntu_stop_telegram_uz_sales_bot` | –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞ –Ω–∞ Ubuntu |
| `ubuntu_restart_telegram_uz_sales_bot` | **–°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–ª–æ—è!)** |
| `TELEGRAM_BOT_DEPLOY.md` | **–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é, –æ—Ç–ª–∞–¥–∫–µ –∏ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π (v2.3)** |

## –ß—Ç–æ –¥–µ–ø–ª–æ–π –∫–æ–ø–∏—Ä—É–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä

- `src/` (–≤—Å—è –ø–∞–ø–∫–∞, –≤–∫–ª—é—á–∞—è `src/telegram_bot/`)
- `migrations/`, `requirements.txt`, **`.env`** (—Å —Ç–æ–∫–µ–Ω–æ–º –±–æ—Ç–∞!), `sales_sql.sql`

**–í–ê–ñ–ù–û:** –¢–µ–ø–µ—Ä—å –¥–µ–ø–ª–æ–π –∫–æ–ø–∏—Ä—É–µ—Ç `.env` (–Ω–µ `.env.example`), –ø–æ—ç—Ç–æ–º—É –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –±—É–¥–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è.

**–°–∫—Ä–∏–ø—Ç—ã `ubuntu_*` –ù–ï –∫–æ–ø–∏—Ä—É—é—Ç—Å—è** –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π (Windows CRLF ‚Üí Linux LF).
–°–æ–∑–¥–∞–π—Ç–µ –∏—Ö **–û–î–ò–ù –†–ê–ó** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: —Å–º. **`UBUNTU_SCRIPTS_SETUP.txt`**

**–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω—É–∂–Ω–æ –ü–ï–†–ï–ó–ê–ü–£–°–¢–ò–¢–¨ –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
ssh dima@45.141.76.83
cd /var/www/sales.zakharenkov.ru/html
./ubuntu_restart_telegram_uz_sales_bot
```

---

## –ü–æ—á–µ–º—É –ª–æ–∫–∞–ª—å–Ω–æ –ª–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ –Ω–∞ Ubuntu ‚Äî –Ω–µ—Ç

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –±–æ—Ç–µ **–Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –±–æ—Ç–∞**. –ë–æ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞—ë—Ç –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –≤ **SDS API**:

- –ó–∞–ø—Ä–æ—Å: `POST /api/v1/auth/login` —Å —Ç–µ–ª–æ–º `{"login": "...", "password": "..."}`.
- URL API –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π **`SDS_API_URL`** –≤ `.env` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `http://127.0.0.1:8000`).

–¢–æ –µ—Å—Ç—å:

- **–õ–æ–∫–∞–ª—å–Ω–æ**: –±–æ—Ç –∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (uvicorn) –Ω–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ, –æ–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ `.env` –∏ –æ–¥–Ω—É –ë–î ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `agent` –µ—Å—Ç—å –≤ —ç—Ç–æ–π –ë–î ‚Üí –ª–æ–≥–∏–Ω —É—Å–ø–µ—à–µ–Ω.
- **–ù–∞ Ubuntu**: –±–æ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ API –ø–æ –∞–¥—Ä–µ—Å—É –∏–∑ **—Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ** `.env` (`SDS_API_URL`). –ï—Å–ª–∏ —Ç–∞–º —Ç–æ—Ç –∂–µ API –∏ —Ç–∞ –∂–µ –ë–î ‚Äî –ª–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç—å. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –±—É–¥–µ—Ç ¬´–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å¬ª.

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Ubuntu

1. **–ï—Å—Ç—å –ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ñ–∞–π–ª `.env`** (–Ω–µ —Ç–æ–ª—å–∫–æ `.env.example`), –∏ –ø—Ä–æ–ø–∏—Å–∞–Ω –ª–∏ –≤ –Ω–µ–º—É **`SDS_API_URL`**.
   - –ï—Å–ª–∏ API –∫—Ä—É—Ç–∏—Ç—Å—è –Ω–∞ —Ç–æ–º –∂–µ —Å–µ—Ä–≤–µ—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, gunicorn/uvicorn –∑–∞ nginx): –æ–±—ã—á–Ω–æ `SDS_API_URL=http://127.0.0.1:8000` (–∏–ª–∏ —Ç–æ—Ç –ø–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å–ª—É—à–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ).
   - –ï—Å–ª–∏ API —Ç–æ–ª—å–∫–æ —Å–Ω–∞—Ä—É–∂–∏: `SDS_API_URL=https://sales.zakharenkov.ru` (–±–µ–∑ —Å–ª—ç—à–∞ –≤ –∫–æ–Ω—Ü–µ).

2. **–ó–∞–ø—É—â–µ–Ω –ª–∏ –Ω–∞ Ubuntu –≤–µ–±-—Å–µ—Ä–≤–µ—Ä —Å SDS API** (—Ç–æ—Ç –∂–µ `src.main:app`). –ü–æ–∫–∞ –æ–Ω –Ω–µ –∑–∞–ø—É—â–µ–Ω, –±–æ—Ç –Ω–µ —Å–º–æ–∂–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –∑–∞–ø—Ä–æ—Å –∫ API –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—à–∏–±–∫—É.

3. **–¢–∞ –∂–µ –ª–∏ –ë–î –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –Ω–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –∏ —É –±–æ—Ç–∞.**
   - –í `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–µ –∂–µ `DATABASE_*` (–∏–ª–∏ `DATABASE_URL`), —á—Ç–æ –∏ —É –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ API.
   - –í —ç—Ç–æ–π –ë–î –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ª–æ–≥–∏–Ω–æ–º `agent` —Å —Ç–µ–º –∂–µ –ø–∞—Ä–æ–ª–µ–º, —á—Ç–æ –∏ –ª–æ–∫–∞–ª—å–Ω–æ. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏ –∏–ª–∏ –ø–∞—Ä–æ–ª–∏ –¥—Ä—É–≥–∏–µ ‚Äî –ª–æ–≥–∏–Ω –±—É–¥–µ—Ç ¬´–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å¬ª.

4. **–õ–æ–≥ –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** ‚Äî –≤ –Ω—ë–º –≤–∏–¥–Ω–æ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–µ—Ä–Ω—É–ª API:
   ```bash
   tail -100 /var/www/sales.zakharenkov.ru/html/telegram_bot.log
   ```
   –ï—Å–ª–∏ —Ç–∞–º –µ—Å—Ç—å –æ—à–∏–±–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç—ã ‚Äî –±–æ—Ç –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ API. –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Ö–æ–¥–∏—Ç, –Ω–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç 401/400 ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ –≤ —É—á—ë—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –≤ —Ç–æ–º, –∫–∞–∫–æ–π API/–ë–î –æ—Ç–≤–µ—á–∞–µ—Ç.

### –ö—Ä–∞—Ç–∫–∏–π —á–µ–∫–ª–∏—Å—Ç

- [ ] –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å `.env` —Å `TELEGRAM_BOT_TOKEN` –∏ `SDS_API_URL`.
- [ ] –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∑–∞–ø—É—â–µ–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ SDS (uvicorn/gunicorn), –∏ –æ–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É –∏–∑ `SDS_API_URL`.
- [ ] –ë–æ—Ç –∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –∏ —Ç—É –∂–µ –ë–î.
- [ ] –í —ç—Ç–æ–π –ë–î –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `agent` —Å –Ω—É–∂–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º (–∏–ª–∏ –≤—ã —Å–æ–∑–¥–∞–ª–∏ –µ–≥–æ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å/–º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ).

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∏–Ω –≤ –±–æ—Ç–µ –Ω–∞ Ubuntu –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–∞–∫ –∂–µ, –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–æ.

---

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –≤–µ—Ä—Å–∏–∏ 2.3 (2026-02-16)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #28: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî –ú–µ–Ω—é –ø–æ–ª–µ–π –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –ò–ù–ù

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –ò–ù–ù –ø–æ–ª—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–µ—Ä–µ—Å—Ç–∞—é—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è.

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `handlers_agent.py`:**
1. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `cb_agent_addcust_back_to_fields()` ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –∫ –º–µ–Ω—é –ø–æ–ª–µ–π –±–µ–∑ –≤–≤–æ–¥–∞ –∑–Ω–∞—á–µ–Ω–∏—è
2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é –ø–æ–ª–µ–π" –≤ `cb_agent_addcust_field()` –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ–ª—è
3. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
   - `logger.info("User X: INN validated, showing fields menu")`
   - `logger.info("User X: Fields menu sent")`
   - `logger.info("User X: Showing fields menu (is_callback=...)")`
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `agent_addcust_back_to_fields`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```
–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ ‚Üí –ù–∞–∑–≤–∞–Ω–∏–µ ‚Üí –ò–ù–ù (9-12 —Ü–∏—Ñ—Ä) ‚Üí –î–û–õ–ñ–ù–û –ü–û–Ø–í–ò–¢–¨–°–Ø –ú–ï–ù–Æ –ü–û–õ–ï–ô
```

–ú–µ–Ω—é –ø–æ–ª–µ–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–∞–ª–æ—á–∫–∏ ‚úì –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π:
- –ù–∞–∑–≤–∞–Ω–∏–µ ‚úì
- –ò–ù–ù ‚úì
- –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏—Ä–º—ã
- –†/—Å
- –ê–¥—Ä–µ—Å
- –ì–æ—Ä–æ–¥
- –¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è
- –¢–µ–ª–µ—Ñ–æ–Ω
- –ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ
- üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–≥–µ–æ–ª–æ–∫–∞—Ü–∏—è)
- üì∏ –§–æ—Ç–æ

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –ª—é–±–æ–µ –ø–æ–ª–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–º–ø—Ç –¥–ª—è –≤–≤–æ–¥–∞ –∏ –∫–Ω–æ–ø–∫–∞ "‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é –ø–æ–ª–µ–π".

**–õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:**
```bash
grep "INN validated\|showing fields menu\|Fields menu sent" telegram_bot.log
```

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #32: –°–æ–∑–¥–∞—Ç—å –≤–∏–∑–∏—Ç ‚Äî –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ—Å–ª–µ –ø–æ–∏—Å–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ –≤—ã–≤–æ–¥—è—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –≤–∏–∑–∏—Ç.

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `handlers_agent.py`:**
1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_clear_agent_state()` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–ª–∞–≥–∏:
   ```python
   "create_visit_search", "create_visit_customer_id", "create_visit_date",
   "create_visit_time", "create_visit_date_input", "create_visit_time_input",
   ```
2. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `cb_agent_create_visit()`:
   - `logger.info("User X: Starting visit creation, create_visit_search=True")`
3. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `_handle_create_visit_search()`:
   - `logger.info("User X: Handling create visit search")`
   - `logger.info("User X: Searching customers with query: ...")`
   - `logger.info("User X: Found N customers")`
   - `logger.info("User X: Sending N customer buttons")`
4. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `msg_agent_text()`:
   - `logger.debug("User X: Text message received: '...'")`
   - `logger.debug("User X: Active states: {...}")`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```
–°–æ–∑–¥–∞—Ç—å –≤–∏–∑–∏—Ç ‚Üí –í–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è/–ò–ù–ù ‚Üí –î–û–õ–ñ–ï–ù –ü–û–Ø–í–ò–¢–¨–°–Ø –°–ü–ò–°–û–ö –ö–õ–ò–ï–ù–¢–û–í
```

–ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏:
- [–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ 1]
- [–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ 2]
- ...
- [‚óÄÔ∏è –ù–∞–∑–∞–¥]

**–õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:**
```bash
grep "create visit\|Searching customers\|Found.*customers\|Sending.*customer buttons" telegram_bot.log
```

---

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –¢–µ—Å—Ç #28: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ —Å –º–µ–Ω—é –ø–æ–ª–µ–π

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `/start`
2. –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ —Ä–æ–ª—å—é "agent"
3. –ù–∞–∂–º–∏—Ç–µ "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞"
4. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: `–¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç`
5. –í–≤–µ–¥–∏—Ç–µ –ò–ù–ù: `123456789` (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å")
6. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –º–µ–Ω—é –ø–æ–ª–µ–π —Å –≥–∞–ª–æ—á–∫–∞–º–∏
7. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–æ–ª–µ "–ê–¥—Ä–µ—Å"
8. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ "‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é –ø–æ–ª–µ–π"
9. –ù–∞–∂–º–∏—Ç–µ "‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é –ø–æ–ª–µ–π"
10. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í–µ—Ä–Ω—É–ª–∏—Å—å –∫ –º–µ–Ω—é –ø–æ–ª–µ–π
11. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π (–∞–¥—Ä–µ—Å, —Ç–µ–ª–µ—Ñ–æ–Ω, –∏ —Ç.–¥.)
12. –ù–∞–∂–º–∏—Ç–µ "‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–≤–µ–¥–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞"
13. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω

### –¢–µ—Å—Ç #32: –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑–∏—Ç–∞ —Å –ø–æ–∏—Å–∫–æ–º –∫–ª–∏–µ–Ω—Ç–∞

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `/start`
2. –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ —Ä–æ–ª—å—é "agent"
3. –ù–∞–∂–º–∏—Ç–µ "üÜï –°–æ–∑–¥–∞—Ç—å –≤–∏–∑–∏—Ç"
4. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –ò–ù–ù: `–¢–µ—Å—Ç` (–∏–ª–∏ –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å)
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
6. –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É)
7. –í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É: `25.02.2026`
8. –í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è: `14:30` (–∏–ª–∏ `/skip`)
9. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑–∏—Ç–∞
10. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í–∏–∑–∏—Ç —Å–æ–∑–¥–∞–Ω

---

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª—ã –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã:**
   ```bash
   ssh dima@45.141.76.83
   cd /var/www/sales.zakharenkov.ru/html
   ls -la src/telegram_bot/handlers_agent.py
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω:**
   ```bash
   ./ubuntu_restart_telegram_uz_sales_bot
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "Telegram bot started (PID XXXXX)"
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   tail -50 telegram_bot.log
   # –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ —Å —É—Ä–æ–≤–Ω–µ–º INFO –æ—Ç —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –≤–∞—à–µ–≥–æ Telegram user ID:**
   ```bash
   # –£–∑–Ω–∞–π—Ç–µ —Å–≤–æ–π Telegram user ID (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏ /start)
   grep "User YOUR_ID" telegram_bot.log | tail -20
   ```

5. **–ï—Å–ª–∏ –ª–æ–≥–æ–≤ –Ω–µ—Ç –∏–ª–∏ –æ–Ω–∏ —Å—Ç–∞—Ä—ã–µ:**
   - –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω ‚Üí `./ubuntu_telegram_uz_sales_bot`
   - –ë–æ—Ç –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω ‚Üí –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–µ–ø–ª–æ–π –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

---

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: **TELEGRAM_BOT_DEPLOY.md**
