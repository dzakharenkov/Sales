# Структура проекта Sales и вход в систему

## Где лежат файлы приложения

Все файлы приложения находятся в папке **Sales** (текущий проект):

```
D:\Python\Sales\
├── src/                          # Исходный код приложения
│   ├── main.py                    # Точка входа FastAPI
│   ├── core/                      # Ядро: безопасность и зависимости
│   │   ├── security.py            # Хеш паролей, JWT
│   │   └── deps.py                # get_current_user, require_admin
│   ├── database/
│   │   ├── connection.py          # Подключение к PostgreSQL
│   │   └── models.py              # Модели таблиц (users, product, ...)
│   └── api/v1/routers/
│       ├── auth.py                # POST /api/v1/auth/login
│       ├── users.py               # Управление пользователями (admin)
│       ├── dictionary.py          # Товары CRUD, склады, типы
│       └── customers.py           # Клиенты
├── set_admin_password.py         # Скрипт установки пароля админу
├── run.bat                        # Запуск API под Windows
├── requirements.txt
├── .env.example
└── README.md
```

Взаимодействие с БД идёт **через браузер** (или любой HTTP-клиент): вы вызываете API, сервер обращается к PostgreSQL на сервере.

---

## Где войти в систему (логин и пароль)

1. **Один раз** установите пароль администратору (из папки `D:\Python\Sales`):
   ```bat
   python set_admin_password.py
   ```
   Дважды нажмите Enter — будут использованы **логин: dzakharenkov**, **пароль: admin123**. Либо введите свои или: `python set_admin_password.py dzakharenkov МойПароль`.

2. **Запустите сервер:** `run.bat` или:
   ```bat
   python -m uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload
   ```

3. **Откройте в браузере:**  
   **http://127.0.0.1:8000** или **http://127.0.0.1:8000/login**

4. На странице входа введите **логин** и **пароль** (например dzakharenkov / admin123) и нажмите **Войти**. Токены нигде вводить не нужно — страница сама сохраняет их и открывает интерфейс системы. Дальше можно перейти в «Документация API» для работы с товарами и пользователями.

---

## Роли и возможности

| Роль      | Возможности |
|-----------|-------------|
| **admin** | Полный доступ: товары (добавить/изменить/удалить), пользователи (список, создать, смена пароля), клиенты, справочники. |
| agent, expeditor, stockman, paymaster | Просмотр товаров, складов, клиентов; создание клиентов. Изменение/удаление товаров и управление пользователями — только admin. |

---

## Основные эндпоинты (все под /api/v1, кроме login требуют авторизации)

| Метод | URL | Описание |
|-------|-----|----------|
| POST | /auth/login | Вход (логин + пароль) → JWT |
| GET  | /dictionary/products | Список товаров |
| POST | /dictionary/products | Добавить товар (admin) |
| PUT  | /dictionary/products/{code} | Изменить товар (admin) |
| DELETE | /dictionary/products/{code} | Деактивировать товар (admin) |
| GET  | /users | Список пользователей (admin) |
| POST | /users | Создать пользователя с паролем (admin) |
| POST | /users/{login}/set-password | Установить/сменить пароль (admin) |
| GET  | /customers | Список клиентов |
| POST | /customers | Добавить клиента |

Итог: **вход в систему** — через **POST /api/v1/auth/login** в браузере (например, на странице http://127.0.0.1:8000/docs), затем использование выданного токена в **Authorize** для доступа к приложению.
