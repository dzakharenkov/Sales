# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é Telegram-–±–æ—Ç–∞

## –ù–æ–≤–æ–µ –≤ –≤–µ—Ä—Å–∏–∏ 3.0 (2026-02-16)

### –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞" —Å FSM ‚Äî –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø –°–û –í–°–ï–ú–ò –ü–û–õ–Ø–ú–ò –ë–î

**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `handlers_agent_v3_add_customer.py` (1204 —Å—Ç—Ä–æ–∫–∏)

**–ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ **11 —à–∞–≥–æ–≤** –ª–∏–Ω–µ–π–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ –±–µ–∑ "–∑–∞–≤–∏—Å–∞–Ω–∏–π"
- ‚úÖ **–í—Å–µ –ø–æ–ª—è –∏–∑ –ë–î customers**: name_client, tax_id (–ò–ù–ù), firm_name, phone, contact_person, address, city, territory, account_no
- ‚úÖ **–ö–†–ò–¢–ò–ß–ù–û: –ê–≤—Ç–æ–ø—Ä–∏–≤—è–∑–∫–∞ login_agent** –∏–∑ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–í–ê–ñ–ù–û: –í—ã–±–æ—Ä login_expeditor** –∏–∑ —Å–ø–∏—Å–∫–∞ —ç–∫—Å–ø–µ–¥–∏—Ç–æ—Ä–æ–≤ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è** (latitude/longitude) —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "üìç –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã"
- ‚úÖ FSM (Finite State Machine) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ConversationHandler
- ‚úÖ –ö–Ω–æ–ø–∫–∏ –ù–∞–∑–∞–¥/–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å/–û—Ç–º–µ–Ω–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- ‚úÖ –ü–æ–∫–∞–∑ —É–∂–µ –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –≥–∞–ª–æ—á–∫–∞–º–∏ ‚úÖ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- ‚úÖ –≠–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ –í–°–ï–ú–ò –ø–æ–ª—è–º–∏
- ‚úÖ –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–Ω–µ—Ü —á–∞—Ç–∞ (reply_text, –±–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- ‚úÖ –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: –≤–∞–ª–∏–¥–∞—Ü–∏—è, API, —Å–µ—Å—Å–∏–∏
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —Å ID –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è

**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥ API:**
- `api.get_users(token)` ‚Äî –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—ç–∫—Å–ø–µ–¥–∏—Ç–æ—Ä–æ–≤)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –í–æ–π–¥–∏—Ç–µ –≤ –±–æ—Ç–∞ –∫–∞–∫ agent
2. –ù–∞–∂–º–∏—Ç–µ "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞"
3. –®–∞–≥ 1: –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)
4. –®–∞–≥ 2: –í–≤–µ–¥–∏—Ç–µ –ò–ù–ù (9-12 —Ü–∏—Ñ—Ä) –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
5. –®–∞–≥ 3: –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏—Ä–º—ã –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
6. –®–∞–≥ 4: –í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
7. –®–∞–≥ 5: –í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
8. –®–∞–≥ 6: –í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
9. –®–∞–≥ 7: –í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
10. –®–∞–≥ 8: –í–≤–µ–¥–∏—Ç–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
11. –®–∞–≥ 9: –í–≤–µ–¥–∏—Ç–µ —Ä–∞—Å—á—ë—Ç–Ω—ã–π —Å—á—ë—Ç –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
12. –®–∞–≥ 10: –í—ã–±–µ—Ä–∏—Ç–µ —ç–∫—Å–ø–µ–¥–∏—Ç–æ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
13. –®–∞–≥ 11: –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é (–∫–Ω–æ–ø–∫–∞ "üìç –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã") –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
14. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–æ –í–°–ï–ú–ò –≤–≤–µ–¥—ë–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
15. –ù–∞–∂–º–∏—Ç–µ "‚úÖ –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞"
16. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è: "‚úÖ –ö–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! ID: XXX"

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```python
# 12 —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM
ASK_NAME, ASK_TAX_ID, ASK_FIRM_NAME, ASK_PHONE, ASK_CONTACT_PERSON,
ASK_ADDRESS, ASK_CITY, ASK_TERRITORY, ASK_ACCOUNT_NO, ASK_EXPEDITOR,
ASK_LOCATION, CONFIRM = range(12)

# –õ–∏–Ω–µ–π–Ω—ã–π –ø–æ—Ç–æ–∫:
–ù–∞–∑–≤–∞–Ω–∏–µ ‚Üí –ò–ù–ù ‚Üí –§–∏—Ä–º–∞ ‚Üí –¢–µ–ª–µ—Ñ–æ–Ω ‚Üí –ö–æ–Ω—Ç–∞–∫—Ç ‚Üí –ê–¥—Ä–µ—Å ‚Üí –ì–æ—Ä–æ–¥ ‚Üí –¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è
  ‚Üí –†/—Å ‚Üí –≠–∫—Å–ø–µ–¥–∏—Ç–æ—Ä ‚Üí –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

–ù–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ:
  ‚Üì
–ù–∞–∑–∞–¥ / –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å / –û—Ç–º–µ–Ω–∞
```

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç python-telegram-bot ConversationHandler
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ context.user_data —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `new_customer_v3_`
- Callback patterns: `addcust_v3_*`, `addcust_v3_exp_{login}`
- –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ reply_text (–Ω–µ edit_message_text)
- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ ReplyKeyboardMarkup —Å KeyboardButton(request_location=True)
- –ê–≤—Ç–æ–ø—Ä–∏–≤—è–∑–∫–∞ –∞–≥–µ–Ω—Ç–∞: `"login_agent": session.login` (–°–¢–†–û–ö–ê 1011)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `logger.info(f"User {tg_id}: Step X, action Y")`

---

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –≤–µ—Ä—Å–∏–∏ 2.3

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #28: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –ø–æ–ª–µ–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –ò–ù–ù –ø–æ–ª—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–µ—Ä–µ—Å—Ç–∞—é—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è.

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é –ø–æ–ª–µ–π" –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ `_clear_agent_state` (–¥–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–ª–∞–≥–∏ `create_visit_*`)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞"
2. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
3. –í–≤–µ–¥–∏—Ç–µ –ò–ù–ù (9-12 —Ü–∏—Ñ—Ä) –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
4. **–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –º–µ–Ω—é –ø–æ–ª–µ–π —Å –≥–∞–ª–æ—á–∫–∞–º–∏** –¥–ª—è: –ù–∞–∑–≤–∞–Ω–∏–µ, –ò–ù–ù, –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏—Ä–º—ã, –†/—Å, –ê–¥—Ä–µ—Å, –ì–æ—Ä–æ–¥, –¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è, –¢–µ–ª–µ—Ñ–æ–Ω, –ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ, –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, –§–æ—Ç–æ
5. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–µ –ø–æ–ª–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
6. –¢–µ–ø–µ—Ä—å –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ "‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é –ø–æ–ª–µ–π" –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –±–µ–∑ –≤–≤–æ–¥–∞ –∑–Ω–∞—á–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #32: –°–æ–∑–¥–∞—Ç—å –≤–∏–∑–∏—Ç ‚Äî –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ –≤—ã–≤–æ–¥—è—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –≤–∏–∑–∏—Ç.

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π (–¥–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–ª–∞–≥–∏ `create_visit_search`, `create_visit_customer_id`, –∏ —Ç.–¥.)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –≤–∏–∑–∏—Ç"
2. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –ò–ù–ù
3. **–î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤** —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞
4. –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞
5. –í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –≤–∏–∑–∏—Ç–∞ (–î–î.–ú–ú.–ì–ì–ì–ì)
6. –í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –≤–∏–∑–∏—Ç–∞ (–ß–ß:–ú–ú) –∏–ª–∏ /skip
7. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑–∏—Ç–∞

---

## –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä Ubuntu

### –®–∞–≥ 1: –î–µ–ø–ª–æ–π —Ñ–∞–π–ª–æ–≤ —Å Windows –Ω–∞ Ubuntu
```cmd
deploy_to_ubuntu.bat
```

–°–∫—Ä–∏–ø—Ç —Å–∫–æ–ø–∏—Ä—É–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
- `src/` ‚Äî –≤–µ—Å—å –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –±–æ—Ç–∞
- `migrations/` ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- `requirements.txt` ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
- `.env` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–æ–∫–µ–Ω –±–æ—Ç–∞, API URL, –ë–î)
- `sales_sql.sql` ‚Äî SQL-—Å–∫—Ä–∏–ø—Ç—ã

**–í–ê–ñ–ù–û:** –°–∫—Ä–∏–ø—Ç—ã `ubuntu_*` –ù–ï –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π Windows‚ÜíLinux).
–°–æ–∑–¥–∞–π—Ç–µ –∏—Ö **–û–î–ò–ù –†–ê–ó** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, —Å–ª–µ–¥—É—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ —Ñ–∞–π–ª–µ `UBUNTU_SCRIPTS_SETUP.txt`.

### –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É Ubuntu
```bash
ssh dima@45.141.76.83
cd /var/www/sales.zakharenkov.ru/html
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∏–ª–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è requirements.txt)
```bash
# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
python3 -m venv venv

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å venv
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
```bash
# –í–ê–ñ–ù–û: –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–π—Ç–µ –±–æ—Ç–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è!
./ubuntu_restart_telegram_uz_sales_bot
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
./ubuntu_stop_telegram_uz_sales_bot

# –ü–æ–¥–æ–∂–¥–∞—Ç—å 2 —Å–µ–∫—É–Ω–¥—ã
sleep 2

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
./ubuntu_telegram_uz_sales_bot
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∞
tail -50 telegram_bot.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f telegram_bot.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
grep -i "error\|exception\|traceback" telegram_bot.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–º–µ–Ω–∏—Ç–µ 123456 –Ω–∞ Telegram user ID)
grep "User 123456" telegram_bot.log
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø—É—â–µ–Ω –ª–∏ –±–æ—Ç
cat telegram_bot.pid && echo "Bot is running" || echo "Bot is not running"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
ps aux | grep telegram_bot
```

**–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤:**
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥-—Ñ–∞–π–ª
> telegram_bot.log

# –ò–ª–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π –ª–æ–≥
mv telegram_bot.log telegram_bot_$(date +%Y%m%d_%H%M%S).log
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª
cat .env

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–ø–µ—Ä–≤—ã–µ 10 —Å–∏–º–≤–æ–ª–æ–≤)
grep TELEGRAM_BOT_TOKEN .env | cut -c1-30
```

---

## –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -50 telegram_bot.log`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ `.env`: `grep TELEGRAM_BOT_TOKEN .env`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î: `grep DATABASE .env`
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é: `python3 -m src.telegram_bot.bot`

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid URL" –∏–ª–∏ –æ—à–∏–±–∫–∏ —Å '\r'
**–†–µ—à–µ–Ω–∏–µ:** CRLF line endings –≤ .env —Ñ–∞–π–ª–µ (Windows ‚Üí Linux)
- –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `config.py` –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º `.strip()`
- –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞: `dos2unix .env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –ü—Ä–æ–±–ª–µ–º–∞: "–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞" –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ Ubuntu
psql -h 45.141.76.83 -p 5433 -U postgres -d localdb -c "SELECT COUNT(*) FROM telegram_bot_sessions;"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–Ω—é –ø–æ–ª–µ–π (#28) –∏–ª–∏ —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ (#32) –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –≤–∞—à–µ–≥–æ Telegram user ID:
   ```bash
   grep "User YOUR_TELEGRAM_ID" telegram_bot.log | tail -20
   ```
2. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
   - `INN validated, showing fields menu` (–¥–ª—è #28)
   - `Handling create visit search` –∏ `Found N customers` (–¥–ª—è #32)
3. –ï—Å–ª–∏ –ª–æ–≥–æ–≤ –Ω–µ—Ç ‚Äî –±–æ—Ç –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: `./ubuntu_restart_telegram_uz_sales_bot`

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

- [ ] –§–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä (`deploy_to_ubuntu.bat`)
- [ ] –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É Ubuntu (`ssh dima@45.141.76.83`)
- [ ] –ü–µ—Ä–µ—à–ª–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (`cd /var/www/sales.zakharenkov.ru/html`)
- [ ] –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª–∏ –±–æ—Ç–∞ (`./ubuntu_restart_telegram_uz_sales_bot`)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ –ª–æ–≥–∏ (`tail -50 telegram_bot.log`)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ Telegram:
  - [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (–≤–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è ‚Üí –ò–ù–ù ‚Üí –º–µ–Ω—é –ø–æ–ª–µ–π)
  - [ ] –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑–∏—Ç–∞ (–ø–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ ‚Üí —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Üí –≤—ã–±–æ—Ä ‚Üí –¥–∞—Ç–∞/–≤—Ä–µ–º—è)
  - [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –∫–ª–∏–µ–Ω—Ç–∞
  - [ ] –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–æ—Ç–∞

```
src/telegram_bot/
‚îú‚îÄ‚îÄ bot.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îú‚îÄ‚îÄ config.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–æ–∫–µ–Ω, API URL, —Ç–∞–π–º–∞—É—Ç—ã)
‚îú‚îÄ‚îÄ sds_api.py                # HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è SDS API
‚îú‚îÄ‚îÄ session.py                # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ (asyncpg ‚Üí –ë–î)
‚îú‚îÄ‚îÄ handlers_auth.py          # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (/start, login/password)
‚îú‚îÄ‚îÄ handlers_agent.py         # –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∞–≥–µ–Ω—Ç–∞ (–∫–ª–∏–µ–Ω—Ç—ã, –≤–∏–∑–∏—Ç—ã, –∑–∞–∫–∞–∑—ã, —Ñ–æ—Ç–æ)
‚îú‚îÄ‚îÄ handlers_expeditor.py     # –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —ç–∫—Å–ø–µ–¥–∏—Ç–æ—Ä–∞ (–º–∞—Ä—à—Ä—É—Ç—ã, –¥–æ—Å—Ç–∞–≤–∫–∞, –æ–ø–ª–∞—Ç–∞)
‚îî‚îÄ‚îÄ helpers.py                # –£—Ç–∏–ª–∏—Ç—ã (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫—ç—à —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤)
```

**–í–∞–∂–Ω–æ:**
- –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î** (asyncpg) –¥–ª—è —Å–µ—Å—Å–∏–π –∏ –ª–æ–≥–æ–≤
- –í—Å–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ **SDS API** (`src/api/`)
- –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ `telegram_bot.log` (—É—Ä–æ–≤–µ–Ω—å INFO)

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### v2.3 (2026-02-16)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #28: –ú–µ–Ω—é –ø–æ–ª–µ–π –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –ò–ù–ù
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #32: –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏–∑–∏—Ç–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é –ø–æ–ª–µ–π"
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ `_clear_agent_state`

### v2.2 (–ø—Ä–µ–¥—ã–¥—É—â–∞—è)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #30: –ö–Ω–æ–ø–∫–∞ "–î–æ—Å—Ç–∞–≤–ª–µ–Ω" –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #33: –ö–Ω–æ–ø–∫–∞ "–ü–æ–ª—É—á–µ–Ω–Ω–∞—è –æ–ø–ª–∞—Ç–∞" –¥–ª—è —ç–∫—Å–ø–µ–¥–∏—Ç–æ—Ä–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ CRLF line endings (.strip() –≤ config.py)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #27: –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –ò–ù–ù (–ø–∞—Ä–∞–º–µ—Ç—Ä search)

---

–£–¥–∞—á–∏! üöÄ
